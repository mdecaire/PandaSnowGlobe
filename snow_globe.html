<!DOCTYPE html>

<html>



<head>

    <meta charset="UTF-8">

    <title>"Snow Globe"</title>

    <link rel="stylesheet" href="demo.css">

    <script src="three.js"></script>

    <script src="TrackballControls.js"></script>



    <script>
        "use strict";

        var canvas, scene, camera, renderer;

        var controls;

        var cameraAndLight;



        function createWorld() {

            renderer.setClearColor(0x8B8989);

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(35, canvas.width / canvas.height, 0.1, 100);
            camera.position.set(40,0, 40);

              var light = new THREE.DirectionalLight();
            light.position.set(0, 0, 0);
            camera.add(light); // Viewpoint light moves with camera.
            scene.add(camera);
          //  scene.add(new THREE.AmbientLight(0x000000));
        
            var globe = drawGlobe();

            var bear = drawBear();

            var snow = drawSnow();

            snow.scale.set(10.9, 10.9, 10.9);



            scene.add(new THREE.AmbientLight(0x000000));

            scene.add(globe);

            bear.rotation.set(0, -.1, 0);

            bear.position.y = -5;



            globe.add(bear);

            // globe.add(snow);
            globe.scale.set(1.1,1.1,1.1,);



        }



        function drawSnow() {

            var points = getPoints();

            var points1 = getPoints();

            var points2 = getPoints();



            var pointMaterial = new THREE.PointCloudMaterial({

                color: "blue",

                size: 2,

                shininess: 10,

                sizeAttenuation: false

            });

            var pointMaterial1 = new THREE.PointCloudMaterial({

                color: "red",

                size: 2,

                shininess: 10,

                sizeAttenuation: false

            });

            var pointMaterial2 = new THREE.PointCloudMaterial({

                color: "green",

                size: 2,

                shininess: 10,

                sizeAttenuation: false

            });



            var sphereOfPoints = new THREE.PointCloud(points, pointMaterial);

            var sphereOfPoints1 = new THREE.PointCloud(points1, pointMaterial1);

            var sphereOfPoints2 = new THREE.PointCloud(points2, pointMaterial2);

            sphereOfPoints.add(sphereOfPoints1);

            sphereOfPoints.add(sphereOfPoints2);

            return sphereOfPoints;

        }

        //taken from the textbook

        function getPoints() {

            var points = new THREE.Geometry();

            while (points.vertices.length < 500) {

                var x = 2 * Math.random() - 1; // (between -1 and 1)

                var y = 2 * Math.random() - 1;

                var z = 2 * Math.random() - 1;

                if (x * x + y * y + z * z < 1) { // use vector only if length is less than 1

                    var pt = new THREE.Vector3(x, y, z);

                    points.vertices.push(pt);

                }

            }

            return points;

        }

        function drawBear() {

            var bear = drawOuterOval();

            var oval1 = drawInnerOval();

            oval1.position.x = 1;

            oval1.position.z = .25;



            var rLeg = drawLeg();

            rLeg.rotation.set(10, 10, 90);

            rLeg.position.x = 2.75;

            rLeg.position.y = -2.45;



            var lLeg = rLeg.clone();

            lLeg.rotation.set(10, 10, 90);

            lLeg.position.x = .65;

            lLeg.position.y = -2.45;

            lLeg.position.z = 2.75;



            var head = drawHead()

            head.position.y = 3.9;

            head.rotation.y = .1;



            var cone = drawIceCream();

            cone.position.set(3.05, 0, 1.5);



            var rArm = drawArm();

            rArm.position.set(3.1, .5, 0);

            rArm.rotation.set(90, -10.2, 10);



            var rHand = drawHand();

            rHand.position.set(3.35, -.5, 1.25);



            var lArm = drawArm()

            lArm.position.set(-1.3, 3.25, 2.7);

            lArm.rotation.set(0, 0, 0);



            var lHand = drawHand();

            lHand.scale.set(.6, .8, .6);

            lHand.position.set(-1.2, 5, 3.0);



            var balloon = drawBalloon();

            balloon.position.set(-.95, 9.65, 2.7);



            bear.add(oval1);

            bear.add(rArm);

            bear.add(lArm);

            bear.add(rHand);

            bear.add(lHand);

            bear.add(rLeg);

            bear.add(lLeg);

            bear.add(head);

            bear.add(cone);

            bear.add(balloon);

            return bear;

        }



        function drawBalloon() {

            var balloon = new THREE.Mesh(

                new THREE.SphereGeometry(1, 100, 100, 0, 2 * Math.PI, 0, Math.PI / 2),

                new THREE.MeshPhongMaterial({

                    color: 0xFF0000,

                    specular: 0x8B7D7B,

                    shininess: 4,

                    flatShading: true



                })

            )

            var bBottom = new THREE.Mesh(

                new THREE.CylinderGeometry(.998, .5, 1.25, 100, 100),

                new THREE.MeshPhongMaterial({

                    color: 0xFF0000,

                    specular: 0x8B7D7B,

                    shininess: 4,

                    flatShading: true



                })

            )

            var ballBottom = new THREE.Mesh(

                new THREE.SphereGeometry(.55, 100, 100),

                new THREE.MeshPhongMaterial({

                    color: 0xFF0000,

                    specular: 0x8B7D7B,

                    shininess: 4,

                    flatShading: true



                })

            )

            var end = new THREE.Mesh(

                new THREE.CylinderGeometry(.05, .1, .1, 64, 10),

                new THREE.MeshPhongMaterial({

                    color: 0xFF0000,

                    specular: 0x8B7D7B,

                    shininess: 4,

                    flatShading: true



                })

            )

            var curveGeom = new THREE.Geometry();

            var cosine = new THREE.Curve();

            cosine.getPoint = function(t) {

                t = (t - 0.5) * 7 * Math.PI;

                return new THREE.Vector2(3 + 2 * Math.cos(t), t);

            }

            var points = cosine.getPoints(128);

            var curveGeom = new THREE.Geometry();

            for (var i = 0; i < points.length; i++) {

                curveGeom.vertices.push(new THREE.Vector3(points[i].x, points[i].y, 0));

            }



            var string = new THREE.Line(curveGeom,

                new THREE.LineBasicMaterial({
                    color: "blue",
                    linewidth: 2
                }));



            string.position.set(-.5, -2.75, 0)

            string.scale.set(.15, .15, 1);

            end.position.y = -1.6;

            end.position.x = 0;

            end.position.z = 0;

            ballBottom.position.y = -1;

            bBottom.position.y = -.61;

            balloon.add(bBottom);

            balloon.add(ballBottom);

            balloon.add(end);

            balloon.add(string);

            return balloon;

        }

        function drawArm() {

            var arm = new THREE.Mesh(

                new THREE.SphereGeometry(2, 100, 100),

                new THREE.MeshLambertMaterial({

                    color: "black"

                })

            );



            arm.scale.set(.25, 1, .25)

            return arm;



        }

        function drawHand() {

            var hand = new THREE.Mesh(

                new THREE.SphereGeometry(.75, 100, 100),

                new THREE.MeshLambertMaterial({

                    color: "black"

                })

            );

            hand.scale.set(1, .8, 1);

            return hand;

        }

        function drawHead() {

            var head = new THREE.Mesh(

                new THREE.SphereGeometry(2, 100, 100),

                new THREE.MeshLambertMaterial({

                    color: "white"

                })

            );

            var lEar = drawEar();

            lEar.position.set(-1, 1.75, .75);

            lEar.rotation.set(-15, 0, 0);



            var rEar = drawEar();

            rEar.position.set(.6, 1.75, -1);

            rEar.rotation.set(15, 0, 0);



            var rEye = drawEye();

            rEye.scale.set(.7, .8, .1);

            rEye.position.set(1.9, .75, .4);

            rEye.rotation.y = -5.3;

            rEye.rotation.z = 1;

            rEye.rotation.x = -.5;



            var lEye = drawEye();

            lEye.scale.set(.7, .8, .1);

            lEye.position.set(.6, .75, 1.9);

            lEye.rotation.z = -.5;

            lEye.rotation.y = .7;

            lEye.rotation.x = -.3;

            var nose = drawNose();

            nose.position.set(1.38, .25, 1.4);



            var mouth = drawMouth();

            mouth.position.set(1.2, -.55, 1.2);

            head.add(lEye);

            head.add(rEye);

            head.add(lEar);

            head.add(rEar);

            head.add(nose);

            head.add(mouth);

            return head;

        }

        function drawMouth() {

            var mouth = new THREE.Mesh(

                new THREE.SphereGeometry(.35, 100, 50),

                new THREE.MeshPhongMaterial({

                    color: "crimson",

                    specular: 0x8B7D7B,

                    shininess: 4,



                })

            );

            mouth.scale.set(.8, 1, .8);

            return mouth;

        }

        function drawEar() {

            var ear = new THREE.Mesh(

                new THREE.SphereGeometry(.54, 100, 50),

                new THREE.MeshPhongMaterial({

                    color: "black",

                    specular: 0x8B7D7B,

                    shininess: 5,



                })

            );

            ear.scale.set(1, .75, 1);



            return ear;

        }



        function drawNose() {

            var nose = new THREE.Mesh(

                new THREE.SphereGeometry(.25, 100, 50),

                new THREE.MeshPhongMaterial({

                    color: "black",

                    specular: 0x8B7D7B,

                    shininess: 4,



                })

            );

            nose.scale.set(1, .8, 1);

            return nose;

        }

        function drawEye() {



            var eye = new THREE.Mesh(

                new THREE.SphereGeometry(.60, 100, 50),

                new THREE.MeshPhongMaterial({

                    color: "black",

                    specular: 0x8B7D7B,

                    shininess: 3,



                })



            );

            var white = new THREE.Mesh(

                new THREE.SphereGeometry(.35, 100, 50),

                new THREE.MeshPhongMaterial({

                    color: "white",

                    specular: 0x8B7D7B,

                    shininess: 3,



                })



            );

            var pupil = new THREE.Mesh(

                new THREE.SphereGeometry(.15, 100, 50),

                new THREE.MeshLambertMaterial({

                    color: 0x3104E8B

                })




            );

            white.position.set(0, 0, .4);

            pupil.position.set(0, 0, .4);

            white.add(pupil);

            eye.scale.set(.75, 1, .75);

            eye.add(white);

            return eye;



        }



        function drawIceCream() {

            var cone = new THREE.Mesh(

                new THREE.CylinderGeometry(.75, .15, 2.5, 64, 10),

                new THREE.MeshLambertMaterial({

                    color: 0xCD853F

                })

            );



            var scoop = new THREE.Mesh(

                new THREE.SphereGeometry(.75, 100, 50, 0, 2 * Math.PI, 0, Math.PI / 2),

                new THREE.MeshLambertMaterial({

                    color: 0xEE7AE9

                })

            )

            scoop.position.y = 1.25;

            cone.add(scoop);

            return cone;



        }




        function drawLeg() {

            var leg = new THREE.Mesh(

                new THREE.CylinderGeometry(.9, 0, 3, 64, 10),

                new THREE.MeshLambertMaterial({

                    color: 'black'

                })

            );

            var bottom = new THREE.Mesh(

                new THREE.CylinderGeometry(.65, .25, .1, 64, 10),

                new THREE.MeshLambertMaterial({

                    color: 0xFFFAFA

                })

            );

            bottom.position.y = 1.5;

            leg.add(bottom.clone());

            return leg;

        }



        function drawOuterOval() {

            var oval = new THREE.Mesh(

                new THREE.SphereGeometry(3.25, 100, 50),

                new THREE.MeshPhongMaterial({

                    color: "black",

                    specular: 0x8B7D7B,

                    shininess: 1,



                })

            )

            return oval;

        }



        function drawInnerOval() {

            var oval = new THREE.Mesh(

                new THREE.SphereGeometry(3, 100, 50),

                new THREE.MeshLambertMaterial({

                    color: 0xFFFAFA

                })

            )

            oval.scale.set(.75, .9, 1);

            return oval;

        }



        function drawGlobe() {

            //lights up the globe taken from 

            //https://github.com/mrdoob/three.js/blob/master/examples/webgl_lights_hemisphere.html

            var hemiLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.6);

            hemiLight.color.setHSL(0.6, 1, 0.6);

            hemiLight.groundColor.setHSL(0.095, 1, 0.75);

            hemiLight.position.set(0, 50, 0);

            var globe = new THREE.Mesh(

                new THREE.SphereGeometry(11.5, 100, 50),

                new THREE.MeshPhongMaterial({

                    color: "white",

                    specular: 0x202020,

                    transparent: true,

                    shininess: 5,

                    opacity: 0.2,

                })

            );

            globe.position.y = 1;

            var base = new THREE.Mesh(

                new THREE.CylinderGeometry(8, 10, 3.5, 64, 10),

                new THREE.MeshPhongMaterial({

                    color: 0x5E2612, // reflectivity for diffuse light

                    specular: 0xA0522D, // reflectivity for specular light

                    shininess: 5 // controls size of specular highlights

                })

            );

            base.position.y = -10;

            globe.add(base.clone());

            var snowLayer = new THREE.Mesh(

                new THREE.CylinderGeometry(8, 8, .1, 50, 10),

                new THREE.MeshLambertMaterial({

                    color: 0xFFFaFa

                })

            );

            snowLayer.position.y = -8.2;

            globe.add(snowLayer.clone());

            globe.add(hemiLight);

            return globe;



        }



        function doFrame() {

            //  updateForFrame();

            controls.update();

            render();

            requestAnimationFrame(doFrame);

        }



        function updateForDrift() {

            for (var i = 0; i < geometry.vertices.length; i++) {

                var v = points[i];

                v.add(driftSpeeds[i]);

                if (v.length() > 1) {

                    // When outside the sphere, change to a random velocity,

                    // and multiply the point by 0.9997 to move it back

                    // towards the inside of the sphere.  Using a value

                    // close to 1 allows the sphere to get a little

                    // fuzzy.

                    driftSpeeds[i] = randomVelocity();

                    v.multiplyScalar(0.9997);

                } else if (Math.random() < 0.001) {

                    // change to a new random velocity, with a small probability

                    driftSpeeds[i] = randomVelocity();

                }

            }

            geometry.verticesNeedUpdate = true;

        }



        function installTrackballControls() {
            controls = new THREE.TrackballControls(camera, canvas);
            controls.noPan = true;
            controls.noZoom = false;
            controls.staticMoving = true;

            function move() {
                controls.update();
                render();
            }

            function down() {
                document.addEventListener("mousemove", move, false);
            }

            function up() {
                document.removeEventListener("mousemove", move, false);
            }

            function touch(event) {
                if (event.touches.length == 1) {
                    move();
                }
            }
            canvas.addEventListener("mousedown", down, false);
            canvas.addEventListener("touchmove", touch, false);
        }


        function render() {
            renderer.render(scene, camera);

        }



        function init() {
            try {
                canvas = document.getElementById("maincanvas");
                renderer = new THREE.WebGLRenderer({
                    canvas: canvas,
                    antialias: true
                });
            } catch (e) {
                document.getElementById("canvas-holder").innerHTML = "<p><b>Sorry, an error occurred:<br>" +
                    e + "</b></p>";
                return;
            }

            createWorld();
            installTrackballControls();
            render();
        }
    </script>

</head>

<body onload="init()">

    <div id="content">

        <h2>A Panda in a Snow Globe</h2>

        <p><b>Use the mouse to rotate the scene.</b>
        </p>

        <div id="canvas-holder">
            <canvas id="maincanvas" width="1000" height="800"></canvas>
        </div>

    </div>


</html>